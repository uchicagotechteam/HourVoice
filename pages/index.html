<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="index.css">
	<script src="//d3js.org/d3.v4.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
	<title>Businesses in Chicago</title>
</head>

<body>
	<script src="index.js"></script>
	<p>List of Businesses in Chicago, according to the City of Chicago Data Portal</p>
	<script>

		var business_licenses = [];

		$.ajax({
			url: "https://data.cityofchicago.org/resource/xqx5-8hwx.json?city='CHICAGO'",
			type: "GET",
			data: {
				"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2",
				"$limit": 5000
			}
		}).done(function(data) {
			business_licenses = data;
			business_licenses.sort(function(a, b) {
				if (a.account_number < b.account_number) {return -1;}
				if (a.account_number > b.account_number) {return 1;}
				return 0;
			});
			$.each(business_licenses, function(i, company) {
				$.ajax({
					url: "https://data.cityofchicago.org/resource/cwcw-dfrk.json?account_number=" + company.account_number,
					type: "GET",
					data: {
						"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2",
					}
				}).done(function(owners) {
					company.owners = owners;
				});
			});

			var nameList;

			var prev_account="";

			document.getElementById("business-list").innerHTML="";
			for (var i = 0; i<5000; i++) {
				if (business_licenses[i].account_number != prev_account) {
					nameList = "<li>" + business_licenses[i].legal_name + "</li>";
					document.getElementById("business-list").innerHTML += nameList;
				}
				prev_account = business_licenses[i].account_number;
			}
		});

			/*var chicago_businesses = 'http://stopwagetheft.stanford.edu/api/v1/cases?&columns=employees_owed_backwages,legal_name,latitude,longitude&city=Chicago';

			$.getJSON(chicago_businesses, function(data) {
			});*/
	</script>

	<div id="business-list"><ul></ul></div>
</body>

</html>