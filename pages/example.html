<!DOCTYPE html>
<html>

	<head>
		
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>
		<link rel="stylesheet" type="text/css" href="example.css">
    	<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>

    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 

	</head>

	<body>

		<h3>Lifecare Auto Services, Inc.</h3>
		<div id="address"></div>

		<div id="mapid"></div>

		<script>
			var chicago_businesses = [];

			function find_radius(backwages) {
				return backwages * 10;
			}

			
			$.getJSON('http://stopwagetheft.stanford.edu/api/v1/cases?&columns=employees_owed_backwages,legal_name,findings_start_date,findings_end_date,latitude,longitude&city=Chicago', function(data) {
				chicago_businesses = data["data"];
			}).done(function(d) {
				var example=chicago_businesses[202];
				var account_num;
				var owners= [];
				var licenses = [];

				$.ajax({
					url: "https://data.cityofchicago.org/resource/cwcw-dfrk.json?doing_business_as_name=" + "LIFECARE AUTO SERVICES INC",
					type: "GET",
					data: {
						"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2",
					}
				}).done(function(business_owners) {
					owners = business_owners;
					account_num=business_owners[0].account_number;

					$.ajax({
						url: "https://data.cityofchicago.org/resource/xqx5-8hwx.json?account_number=" + account_num,
						type: "GET",
						data: {
							"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2",
						}
					}).done(function(business_license) {
						licenses = business_license;
						console.log(licenses);

						var mymap = L.map('mapid').setView([example.latitude, example.longitude], 13);

						L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA', {
		    				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
						    maxZoom: 18,
						    id: 'mapbox.streets',
						    accessToken: 'pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA'
						}).addTo(mymap);

						//var business_marker = L.marker([example.latitude, example.longitude]).addTo(mymap);

						var circle = L.circle([example.latitude, example.longitude], {
							color: 'red',
							fillColor: '#f03',
							radius: find_radius(example.employees_owed_backwages)
						}).addTo(mymap);

						circle.bindPopup(licenses[0].doing_business_as_name);

						document.getElementById("address").innerHTML="";
						var address = "<h5>" + licenses[0].address + "</h5>";
						document.getElementById("address").innerHTML+= address;
					});
				});

			});


			/*$.ajax({
				url: "http://api.dol.gov/V1/Compliance/WHD/?KEY=BeuzxASvSLFI_dx9fcegvxz7agMMk0E6063iQxURL00",
				accept: "application/json",
			}).done(function(data) {
				console.log(data);
			})*/


		</script>
			
		
	</body>


</html>