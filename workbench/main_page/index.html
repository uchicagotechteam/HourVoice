<!DOCTYPE html>
<html lang="en">
<head>
	<title>HourVoice</title>
	<meta charset="utf-8">

	
	<link rel="stylesheet" type="text/css" href="main.css">

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
   integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
   crossorigin=""></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 

</head>
<body>

	<header class="wrapper dark">

		<div class="company">
			<h2 id="company_name"><img src="logo.png"></h2>
		</div>
		<nav>
			<ul>
				<li><a href="">About Us</a></li>
				<li><a href="">Watchlist</a></li>
				<li><a href="">Submit Insights</a></li>
				<li><a href="">Contact Us</a></li>
			</ul>
		</nav>
	</header>

	<section class="services">
		<section class="wrapper">

			<h2>Search</h2>

			<input type="text" id="myInput" onkeyup="searchFunction()" placeholder="Enter a business name">

			<div id="mapid"></div>
			<script>
				var mymap = L.map('mapid').setView([41.8781, -87.6298], 13);

				L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA', {
				    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
				    maxZoom: 18,
				    id: 'mapbox.streets',
				    accessToken: 'pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA'
				}).addTo(mymap);

			</script>
		</section>
	</section>

	<script>
		window.onload = function() {
			var url = document.location.href,
        	params = url.split('?')[1].split('=');
        	url = params[1];
        	var name = "";
        	for (i=0; i<url.length; i++) {
        		if (url[i] == '_') {
        			name += " ";
        		} else {
        			name += url[i];
        		}
        	}
        	document.getElementById('company_name').innerHTML = name;
        	console.log(name)
		}
	</script>


	<section class="testimonials">
		<section class="wrapper">
		<div class="title animated wow fadeIn">
			<h2>Index of Companies</h2>
		</div>

		<table id="myTable">
		  <tr class="header">
		    <th style="width:33%;" onclick="sortTable(0)" id="h">Employer</th>
		    <th style="width:27%;" onclick="sortTable(1)" id="h">Address</th>
		    <th style="width:15%" onclick="sortTable(2)" id="h">City</th>
		    <th style="width:15%" onclick="sortTable(3)" id="h">Hourvoice Members</th>
		    <th style="width:10%;" onclick="sortTable(4)" id="h">Score</th>
		  </tr>
		</table>

		<script>
			var business_info = []


			$.ajax({
				url: "https://data.cityofchicago.org/resource/xqx5-8hwx.json",
				type: "GET",
				data: {
					"$limit": 10,
					"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2"
				}
			}).done(function(data) {
				business_info = data;
				var table=document.getElementById("myTable");
				$.each(business_info, function(i, business){
					var row = table.insertRow(i+1);
					var business_name = business.doing_business_as_name.toLowerCase();

					var cell = row.insertCell(0);
					cell.id = business_name;
					cell.innerHTML=business_name;
					cell = row.insertCell(1);
					cell.id = business_name;
					cell.innerHTML=business.address.toLowerCase();
					cell = row.insertCell(2);
					cell.id = business_name;
					cell.innerHTML=business.city.toLowerCase();
					cell = row.insertCell(3);
					cell.id = business_name;
					cell.innerHTML=Math.floor(Math.random() * 50);
					cell = row.insertCell(4);
					cell.id = business_name;
					cell.innerHTML=Math.floor(Math.random() * 100);

				});

				$("tr").click(function(event) {
					var id = event.target.id;
					var temp="";
					if (id != "h") {
						for (i=0; i<id.length; i++) {
							if (id[i] != ' ') {
								temp+=id[i];
							} else {
								temp+='_'
							}
						}
						console.log(temp);

						url = '../company_index.html?name=' + temp;
						document.location.href = url;
					}
				});

			});
			/*need latitude, longitude data for each business*/
			var marker = L.marker([41.8781, -87.6298]).addTo(mymap);
			var circle = L.circle([41.8781, -87.6298], {
			    color: 'red',
			    fillColor: '#f03',
			    fillOpacity: 0.5,
			    radius: 30
			}).addTo(mymap);


		</script>



		<script>
			function searchFunction() {
			  // Declare variables 
			  var input, filter, table, tr, td, i;
			  input = document.getElementById("myInput");
			  filter = input.value.toUpperCase();
			  table = document.getElementById("myTable");
			  tr = table.getElementsByTagName("tr");

			  // Loop through all table rows, and hide those who don't match the search query
			  for (i = 0; i < tr.length; i++) {
			    td = tr[i].getElementsByTagName("td")[0];
			    if (td) {
			      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
			        tr[i].style.display = "";
			      } else {
			        tr[i].style.display = "none";
			      }
			    }
			  }
			}

			function sortTable(n) {
			  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
			  table = document.getElementById("myTable");
			  switching = true;
			  // Set the sorting direction to ascending:
			  dir = "asc"; 
			  /* Make a loop that will continue until
			  no switching has been done: */
			  while (switching) {
			    // Start by saying: no switching is done:
			    switching = false;
			    rows = table.getElementsByTagName("TR");
			    /* Loop through all table rows (except the
			    first, which contains table headers): */
			    for (i = 1; i < (rows.length - 1); i++) {
			      // Start by saying there should be no switching:
			      shouldSwitch = false;
			      /* Get the two elements you want to compare,
			      one from current row and one from the next: */
			      x = rows[i].getElementsByTagName("TD")[n];
			      y = rows[i + 1].getElementsByTagName("TD")[n];
			      /* Check if the two rows should switch place,
			      based on the direction, asc or desc: */
			      if (dir == "asc") {
			        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
			          // If so, mark as a switch and break the loop:
			          shouldSwitch= true;
			          break;
			        }
			      } else if (dir == "desc") {
			        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
			          // If so, mark as a switch and break the loop:
			          shouldSwitch= true;
			          break;
			        }
			      }
			    }
			    if (shouldSwitch) {
			      /* If a switch has been marked, make the switch
			      and mark that a switch has been done: */
			      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			      switching = true;
			      // Each time a switch is done, increase this count by 1:
			      switchcount ++; 
			    } else {
			      /* If no switching has been done AND the direction is "asc",
			      set the direction to "desc" and run the while loop again. */
			      if (switchcount == 0 && dir == "asc") {
			        dir = "desc";
			        switching = true;
			      }
			    }
			  }
			}
		</script>
	</section>
	</section><!--  End testimonials  -->


	<footer>
		<div class="wrapper">
			<div class="rights">
				<p>HourVoice</p>
			</div>

			<nav>
				<ul>
					<li><a href="#">About</a></li>
					<li><a href="#">FAQ</a></li>
					<li><a href="#">Contact</a></li>
				</ul>
			</nav>
		</div>		
	</footer><!--  End footer  -->
</body>
</html>