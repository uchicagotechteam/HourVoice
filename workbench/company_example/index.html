<!DOCTYPE html>
<html lang="en">
<head>
	<title>Company Index</title>
	<meta charset="utf-8">

	
	<link rel="stylesheet" type="text/css" href="reset.css">
	<link rel="stylesheet" type="text/css" href="main.css">
	<link rel="stylesheet" type="text/css" href="animate.css">
	

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
   crossorigin=""/>
   
   <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
   integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
   crossorigin=""></script>
   <script src="https://d3js.org/d3.v4.min.js"></script>
   <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 

</head>
<body>

	<header class="wrapper dark">
		<div class="company">
			<h2 id="company_name">Company Name</h2>
		</div>
		<nav>
			<ul>
				<li><a href="">About Us</a></li>
				<li><a href="">Watchlist</a></li>
				<li><a href="">Submit Insights</a></li>
				<li><a href="">Contact Us</a></li>
			</ul>
		</nav>
	</header>


	<section class="basic wrapper">
		<div class="title animated wow fadeIn">
			<h2>About the Company</h2>
			<!--filler text that should have short blurb about company or something-->
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras tempus dictum metus non bibendum. Maecenas molestie arcu quis felis viverra, a luctus velit elementum. Pellentesque vitae magna augue. Proin interdum mi id nibh luctus, a convallis nisi venenatis. Sed eget egestas ipsum, ac ornare massa. Nunc porta vel nisl ut tincidunt. Donec a viverra massa. Phasellus fermentum lectus mauris, vestibulum vehicula metus tristique vel. Suspendisse ut sapien ut nulla porta rutrum. Aenean pulvinar magna vitae blandit tempor. Ut ultrices nisi nec posuere suscipit. Donec ut sapien pellentesque, tincidunt purus non, sollicitudin turpis. Curabitur egestas sem a mi accumsan semper. Cras eu libero rhoncus, efficitur turpis ac, venenatis dolor. Fusce congue cursus consequat.</p>
		</div>
		<div class="info">
			<ul class="clearfix">
				<!--data should be pulled in script below this to populate the 'hello' text--> 
				<li class="animated wow fadeInDown">
					<h4>Address</h4>
					<p id="address">hello</p>
				</li>
				<li class="animated wow fadeInDown">
					<h4>Industry</h4>
					<p id="industry">hello</p>
				</li>
				<li class="animated wow fadeInDown">
					<h4>Business License</h4>
					<p id="license-id">hello</p>
				</li>
				<li class="animated wow fadeInDown">
					<h4>Owner</h4>
					<p id="owner">hello</p>
				</li>
			</ul>
			<script>
				//get data here to populate above info
				$.ajax({
					url: "https://data.cityofchicago.org/resource/xqx5-8hwx.json",
					type: "GET",
					data: {
						"$limit": 1,
						"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2"
					}
				}).done(function(data) {
					document.getElementById('address').innerHTML = data[0].address + ", " + data[0].city +", " + data[0].state + " " + data[0].zip_code;
					document.getElementById('license-id').innerHTML = data[0].license_id;
					var account_num = data[0].account_number;
					console.log(data);

					$.ajax({
						url: "https://data.cityofchicago.org/resource/cwcw-dfrk.json?account_number=" + account_num,
						type: "GET",
						data: {
							"$$app_token": "9HlT94OOuLOGZeRGk9okbPYA2"
						}
					}).done(function(dd) {
						document.getElementById('owner').innerHTML = dd[0].owner_first_name + " " + dd[0].owner_middle_initial + " " + dd[0].owner_last_name;
					});

				});

			</script>
		</div>
	</section>


	<section class="viz wrapper">
		<h2>Company Data</h2>
		<ul class="clearfix">
			<li class="animated wow fadeInDown">
				<div id="mapid"></div>
				<!--map is populated in section named 'labor wrapper'-->
				<span class="separator"></span>
				<h2>Location</h2>
			</li>
			<li class="animated wow fadeInDown"  data-wow-delay=".2s">
				<div id ="rating"></div>
				<script>
					var data = [
					  {name: "1", value: 40},
					  {name: "2", value: 20},
					  {name: "3", value: 30},
					  {name: "4", value: 10},
					  {name: "5", value: 9}
					];

					//should use hourvoice user rating data instead of static data above

					var text = "";

					var width = 300;
					var height = 300;
					var thickness = 50;
					var duration = 750;

					var radius = Math.min(width, height) / 2;
					var color = d3.scaleOrdinal(d3.schemeCategory20);

					var svg = d3.select("#rating")
						.append('svg')
						.attr('class', 'pie')
						.attr('width', width)
						.attr('height', height);

					var g = svg.append('g')
						.attr('transform', 'translate(' + (width/2) + ',' + (height/2) + ')');

					var arc = d3.arc()
						.innerRadius(radius - thickness)
						.outerRadius(radius);

					var pie = d3.pie()
						.value(function(d) { return d.value; })
						.sort(null);

					var path = g.selectAll('path')
						.data(pie(data))
						.enter()
						.append("g")
						.on("mouseover", function(d) {
						      let g = d3.select(this)
						        .style("cursor", "pointer")
						        .style("fill", "black")
						        .append("g")
						        .attr("class", "text-group");
						 
						      g.append("text")
						        .attr("class", "name-text")
						        .text(`${d.data.name}`)
						        .attr('text-anchor', 'middle')
						        .attr('dy', '-1.2em');
						  
						      g.append("text")
						        .attr("class", "value-text")
						        .text(`${d.data.value}`)
						        .attr('text-anchor', 'middle')
						        .attr('dy', '.6em');
						    })
						  .on("mouseout", function(d) {
						      d3.select(this)
						        .style("cursor", "none")  
						        .style("fill", color(this._current))
						        .select(".text-group").remove();
						    })
						  .append('path')
						  .attr('d', arc)
						  .attr('fill', (d,i) => color(i))
						  .on("mouseover", function(d) {
						      d3.select(this)     
						        .style("cursor", "pointer")
						        .style("fill", "white");
						    })
						  .on("mouseout", function(d) {
						      d3.select(this)
						        .style("cursor", "none")  
						        .style("fill", color(this._current));
						    })
						  .each(function(d, i) { this._current = i; });


					g.append('text')
					  .attr('text-anchor', 'middle')
					  .attr('dy', '.35em')
					  .text(text);
				</script>
				<span class="separator"></span>
				<h2>Rating</h2>
			</li>
			<li class="animated wow fadeInDown"  data-wow-delay=".4s">
				<div id="wage">
				</div>
				<script>
					//generic bar chart format
					// Define some sample data
					var data = [
					  { value: 14, label: 'Median' },
					  { value: 12, label: 'Min. Wage' },
					  { value: 31, label: 'Ave. Wage' },
					];

					// Define the dimensions
					var dimensions = {
					  gWidth: 313,
					  gHeight: 313,
					  gMargin: 10,
					  gInnerWidth: 270,
					  gInnerHeight: 270,
					  bMargin: 10
					};
					

					// Define the scales
					var xScale = d3.scaleLinear()
					               .domain ([0, data.length])
					               .range([0, dimensions.gInnerWidth]);


					// Get the max value for the data. This will determine how high our y-scale is
					var maxValue = d3.max(data, function( d ) { return d.value; });

					// Now define the yScale, or vertical scale
					var yScale = d3.scaleLinear()
					               .domain([0, maxValue])
					               .range([0, dimensions.gInnerHeight]);

					// Finally, define the yAxis scale. This is identical to the yScale except that the domain is inverted. This is because the scale is determined from top down, rather than bottom up, and the data would look upside down otherwise.
					var yAxisScale = d3.scaleLinear()
					                   .domain([maxValue, 0])
					                   .range([0, dimensions.gInnerHeight]);

					// Render the chart
					// Select the containing element and append an SVG with your defined width and height
					var chart = d3.select('#wage')
					  .append('svg')
					  .attr('width', dimensions.gWidth)
					  .attr('height', dimensions.gHeight);



					// Render the y-axis
					var yAxis = d3.axisLeft( yAxisScale )
					               // This is to make the horizontal tick lines stretch all the way across the chart
					              .tickSizeInner( -dimensions.gInnerWidth )
					               // This spaces the tick values slights from the axis
					              .tickPadding( 10 );

					chart.append('g')
						.attr('class', 'axis axis-y')
						.attr('transform', 'translate(' + dimensions.gMargin + ',' + dimensions.gMargin + ')')
						.call(yAxis);


					// Define the ticks for the xAxis
					var xTicks = []
					for (var i = 0; i < data.length; i++) {
					  xTicks.push( i + 0.5 ); // 0.5 is to ensure the ticks are offset correctly to match the data
					}
					// Render the x-axis
					var xAxis = d3.axisBottom( xScale )
					              .tickValues( xTicks )
					              .tickFormat(function(d, i) {
					                return data[i].label;
					              });

					chart.append('g')
						.attr('class', 'axis axis-x')
						.attr('transform', 'translate(' + dimensions.gMargin + ', ' + ( dimensions.gMargin + dimensions.gInnerHeight ) + ')')
				     	.call( xAxis );



					// Render the bars
					// This is rendered last so the bars appear on top of the axis and not vice versa
					
					chart.append('g')
					     .selectAll('.' + 'bar-line')
					     .data( data )
					     .enter()
					     .append('rect')
					     .attr('class', 'bar-line')
					     .attr('transform', 'translate(' + dimensions.gMargin + ', ' + dimensions.gMargin + ')')
					     .attr('height', function(d, i) {return yScale(d.value);})
					     .attr('width', (dimensions.gInnerWidth / data.length) - (dimensions.bMargin * 2 ))
					     .attr('x', function( d, i ) { return (dimensions.gInnerWidth / data.length) * i + dimensions.bMargin; })
					     .attr('y', function( d, i ) { return dimensions.gInnerHeight - yScale( d.value );})

				</script>
				<span class="separator"></span>
				<h2>Median Wage</h2>
			</li>
		</ul>
	</section>
	<section class="labor wrapper">
		<!--section for labor data visualizations-->
		<ul class="clearfix">

			<li class="animated wow fadeInDown">
				<div id="backwages"></div>
				<script>
					var companies = 'http://stopwagetheft.stanford.edu/api/v1/cases?&limit=1&columns=employees_owed_backwages,legal_name,latitude,longitude';
					var latitude = 0;
					var longitude = 0;
					
					$.getJSON(companies, function(data) {
						latitude = data["data"][0].latitude;
						longitude=data["data"][0].longitude;
						document.getElementById('backwages').innerHTML=data["data"][0].employees_owed_backwages;
					}).done(function(data) {
						var mymap = L.map('mapid').setView([latitude, longitude], 13);

						L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA', {
						    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
						    maxZoom: 18,
						    id: 'mapbox.streets',
						    accessToken: 'pk.eyJ1IjoiYXJueXplbmciLCJhIjoiY2phMDExaDByMzA1MzJwcG85ZWtoMHBwbCJ9.-PFtNi2OogmhDDJyveEXbA'
						}).addTo(mymap);

						var circle = L.circle([latitude, longitude], {
						    color: 'red',
						    fillColor: '#f03',
						    fillOpacity: 0.5,
						    radius: 200
						}).addTo(mymap);
					});

				</script>
				<h2>Employees Owed Backwages</h2>
			</li>
			<li class="animated wow fadeInDown">
				<div id="violations"></div>
				<script>
					document.getElementById('violations').innerHTML = 5;
					//pull data from api instead of using '5'
				</script>
				<h2>Violations Reported</h2>
			</li>
		</ul>

	</section>

	<script>
		window.onload = function() {
			var url = document.location.href,
        	params = url.split('?')[1].split('=');
        	url = params[1];
        	var name = "";
        	for (i=0; i<url.length; i++) {
        		if (url[i] == '_') {
        			name += " ";
        		} else {
        			name += url[i];
        		}
        	}
        	document.getElementById('company_name').innerHTML = name;
        	console.log(name)
		}
	</script>


	<section class="reviews wrapper">
		<div class="title animated wow fadeIn">
			<h2>User Reviews</h2>
			<hr class="separator"/>
		</div>

		<ul class="clearfix">
			<li class="animated wow fadeInDown">
				<p>User Review #1
				</p>
			</li>
			<li class="animated wow fadeInDown"  data-wow-delay=".2s">
				<p>User Review #2
				</p>
			</li>
			<li class="animated wow fadeInDown"  data-wow-delay=".4s">
				<p>User Review #3
				</p>
			</li>
		</ul>
	</section>


	<footer>
		<div class="wrapper">
			<div class="rights">
				<p>HourVoice</p>
			</div>

			<nav>
				<ul>
					<li><a href="#">About</a></li>
					<li><a href="#">FAQ</a></li>
					<li><a href="#">Contact</a></li>
				</ul>
			</nav>
		</div>		
	</footer><!--  End footer  -->
</body>
</html>